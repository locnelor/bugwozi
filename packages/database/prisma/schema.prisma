generator client {
  provider = "prisma-client-js"
  output   = "../generated/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//********************* system
//账号类型
enum sys_account_provider {
  we_chat
  github
  qq
  email
  phone
  account
}

//系统角色
model sys_user {
  uid       String              @id @default(uuid())
  createdAt DateTime            @default(now())
  updatedAt DateTime            @default(now()) @updatedAt
  name      String
  roleId    String?
  account   String              @unique
  accounts  sys_account[]
  role      sys_role?           @relation(fields: [roleId], references: [uid])
  ban_menus sys_user_ban_menu[]
}

//系统账号
model sys_account {
  uid       String               @id @default(uuid())
  createdAt DateTime             @default(now())
  updatedAt DateTime             @default(now()) @updatedAt
  provider  sys_account_provider
  value     String
  userId    String
  user      sys_user             @relation(fields: [userId], references: [uid])

  @@unique([provider, value])
}

//菜单
model sys_menu {
  uid       String              @id @default(uuid())
  createdAt DateTime            @default(now())
  updatedAt DateTime            @default(now()) @updatedAt
  name      String
  path      String              @unique
  sort      Int                 @default(10)
  powers    Int
  comment   String?             @db.Text
  parentId  String?
  parent    sys_menu?           @relation("SysMenuParent", fields: [parentId], references: [uid])
  children  sys_menu[]          @relation("SysMenuParent")
  roles     sys_menu_on_role[]
  user_bans sys_user_ban_menu[]
}

//用户黑名单
model sys_user_ban_menu {
  user   sys_user @relation(fields: [userId], references: [uid])
  menu   sys_menu @relation(fields: [menuId], references: [uid])
  userId String
  menuId String

  @@id([userId, menuId])
}

//角色菜单
model sys_menu_on_role {
  roleId String
  menuId String
  power  Int      @default(0)
  menu   sys_menu @relation(fields: [menuId], references: [uid])
  role   sys_role @relation(fields: [roleId], references: [uid])

  @@id([roleId, menuId])
}

//角色
model sys_role {
  uid       String             @id @default(uuid())
  createdAt DateTime           @default(now())
  updatedAt DateTime           @default(now()) @updatedAt
  name      String             @unique
  status    Boolean            @default(true)
  comment   String?            @db.LongText
  menus     sys_menu_on_role[]
  users     sys_user[]
  sort      Int                @default(10)
}
